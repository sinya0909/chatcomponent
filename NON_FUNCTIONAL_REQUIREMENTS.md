# Chatコンポーネント 非機能要件書

## 目的
各サービスの無料枠内での運用を前提とする。

## 技術スタック

### フロントエンド
- **Next.js 15**: App Router + React Server Components
- **TypeScript**: 型安全性
- **Chatコンポーネント**: Compound Components パターン

### バックエンド
- **Next.js API Routes**: サーバーサイド処理
- **Node.js**: ランタイム環境
- **Prisma**: ORM（Neon接続）

### インフラ・サービス
- **Vercel**: ホスティング・デプロイ
- **無料枠**: 100GB帯域、関数実行時間制限
- **特徴**: Next.js完全対応、自動デプロイ、Edge Functions

### データベース
- **Neon (PostgreSQL)**: サーバーレス NewSQL
- **無料枠**: 512MB RAM、10GB ストレージ、1000万行
- **特徴**: 自動スケーリング、ブランチング機能

### ORM
- **Prisma**: TypeScript対応ORM
- **選択理由**: Neon完全対応、型安全性、マイグレーション管理

### リアルタイム通信
- **Ably**: WebSocket/Server-Sent Events
- **無料枠**: 300万メッセージ/月、200同時接続
- **特徴**: グローバル配信、自動フェイルオーバー

### API設計
- **構成**: 要検討（実装時に詳細設計）
- **認証**: 外部認証システム連携
- **エンドポイント**: RESTful API（Next.js API Routes）

## パフォーマンス要件（無料枠前提）

### 応答時間
- **メッセージ送信**: < 500ms（無料枠考慮）
- **履歴読み込み**: < 1秒
- **初期接続**: < 3秒

### 同時接続数
- **目標**: 50ユーザー/ルーム（Ably無料枠内）
- **スループット**: 100メッセージ/秒程度

### データ容量
- **メッセージ保存**: 最大1万件/ルーム
- **ユーザー数**: 最大1000ユーザー
- **ルーム数**: 最大100ルーム

## 可用性・信頼性

### 稼働率
- **目標**: 95%以上（無料枠サービス依存）
- **ダウンタイム**: サービス側メンテナンス時のみ

### データ保護
- **バックアップ**: Neonの自動バックアップに依存
- **データ保持**: 基本的に永続化（削除機能は将来実装）

## スケーラビリティ

### NewSQLの利点
- **水平スケーリング**: 利用量増加時の自動拡張
- **サーバーレス**: 使用量に応じた従量課金
- **ブランチング**: 開発環境の簡単な作成

### 将来的な拡張
- **有料プラン移行**: 必要に応じて容量・性能向上
- **地理分散**: グローバル展開時の対応

## セキュリティ要件

### 認証・認可
- **認証**: 外部認証システム（Auth0、NextAuth等）
- **認可**: ルーム参加権限の基本チェック
- **データ検証**: 入力値のサニタイゼーション

### 通信セキュリティ
- **HTTPS**: 全通信の暗号化
- **WebSocket**: TLS/SSL対応
- **API**: CORS設定、レート制限

## 開発・運用要件

### 開発体験
- **型安全性**: TypeScript + Prisma
- **開発環境**: Neonブランチ機能活用
- **デバッグ**: ローカル開発環境の構築容易性

### 監視・ログ
- **エラー監視**: コンソールログレベル
- **パフォーマンス**: 基本的なメトリクス
- **使用量監視**: 無料枠制限の監視

## 制約事項

### 無料枠による制約
- **Neon**: 月間稼働時間制限、接続数制限
- **Ably**: メッセージ数制限、同時接続数制限
- **Vercel**: 関数実行時間、帯域幅制限

### 機能制限
- **ファイル送信**: 画像・ファイルアップロード未対応
- **高度な検索**: 全文検索機能なし
- **分析機能**: 詳細な使用統計なし

## 将来的な拡張性

### スケールアウト戦略
1. **無料枠最適化**: 効率的なリソース使用
2. **段階的有料化**: 必要な機能から有料プラン移行
3. **アーキテクチャ拡張**: マイクロサービス化検討

### 技術的負債の管理
- **定期的な依存関係更新**
- **パフォーマンスボトルネックの特定**
- **コードの保守性向上**

---
*作成日: 2025-07-24*
*対象: 学習・デモ用途*
*前提: 各サービス無料枠内での運用*